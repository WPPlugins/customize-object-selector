!function(a,b){"use strict";a.ObjectSelectorControl=a.Control.extend({initialize:function(c,d){var e,f=this;e=d||{},e.params=_.extend({select2_options:{},post_query_vars:null,setting_property:null},e.params||{}),e.params.post_query_args&&!e.params.post_query_vars&&("undefined"!=typeof console&&console.warn("[customize-object-selector-control] The post_query_args arg is deprecated in favor of post_query_vars."),e.params.post_query_vars=e.params.post_query_args),!0===e.params.select2_options.multiple&&(e.params.select2_options.width="100%"),e.params.select2_options=_.extend({multiple:!1,cache:!1,width:"72%"},e.params.select2_options),e.params.type||(e.params.type="object_selector"),e.params.content||(e.params.content=b("<li></li>"),e.params.content.attr("id","customize-control-"+c.replace(/]/g,"").replace(/\[/g,"-")),e.params.content.attr("class","customize-control customize-control-"+e.params.type)),e.params.select_id=c+String(Math.random()),a.Control.prototype.initialize.call(f,c,e),_.bind(f.handleRemoval,f),a.control.bind("remove",f.handleRemoval)},createSyncedPropertyValue:function(b,c){var d=new a.Value(b.get()[c]);return d.bind(function(a){var d=_.clone(b.get());d[c]=a,b.set(d)}),b.bind(function(a,b){_.isEqual(a[c],b[c])||d.set(a[c])}),d},handleRemoval:function(b){var c=this;b===c&&(c.objectSelector.destroy(),a.control.unbind("remove",c.handleRemoval),c.container.remove(),c.section()&&a.section(c.section())&&a.section(c.section()).expanded.unbind(c.closeDropdownUponSectionClose))},ready:function(){var b,c,d,e=this;c=e.params.setting_property?e.createSyncedPropertyValue(e.setting,e.params.setting_property):e.setting,b=wp.template("customize-object-selector-item"),e.objectSelector=new a.ObjectSelectorComponent({model:c,containing_construct:e,post_query_vars:e.params.post_query_vars,show_add_buttons:e.params.show_add_buttons,select_id:e.params.select_id,select2_options:e.params.select2_options,select2_result_template:b,select2_selection_template:b}),d=e.container.find(".customize-object-selector-container"),e.objectSelector.embed(d),e.objectSelector.select.data("select2").on("keypress",function(a){var b=27;b===a.which&&a.stopPropagation()}),e.params.select2_options.multiple||e.objectSelector.select.on("select2:close",function(){e.objectSelector.select.focus()}),e.closeDropdownUponSectionClose=_.bind(e.closeDropdownUponSectionClose,e),e.section()&&a.section(e.section(),function(a){a.expanded.bind(e.closeDropdownUponSectionClose)}),a.Control.prototype.ready.call(e),a.control.bind("remove",function(a){a.id===e.id&&e.objectSelector.destroy()})},closeDropdownUponSectionClose:function(a){var b=this,c=!!b.objectSelector&&b.objectSelector.select;!a&&c&&c.data("select2")&&c.select2("close")},embed:function(){var b=this,c=b.section();c&&a.section(c,function(c){c.expanded()||a.settings.autofocus.control===b.id?b.actuallyEmbed():c.expanded.bind(function(a){a&&b.actuallyEmbed()})})},actuallyEmbed:function(){var a=this;"resolved"!==a.deferred.embedded.state()&&(a.renderContent(),a.deferred.embedded.resolve())},focus:function(b){var c=this;c.actuallyEmbed(),a.Control.prototype.focus.call(c,b)}}),a.controlConstructor.object_selector=a.ObjectSelectorControl}(wp.customize,jQuery);